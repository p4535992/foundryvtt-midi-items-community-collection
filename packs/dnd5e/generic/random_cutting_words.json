{
  "name": "Random Cutting Words",
  "permission": {
    "default": 0
  },
  "type": "script",
  "flags": {},
  "scope": "global",
  "command": "// Courtesy of @Zarek\r\n// Selected target receives a random cutting word from a table called \"Mockeries\" along with the roll reduction.\r\n// You can find a mockeries table in the community table module.\r\n\r\nlet cuttingWords = async () => {\r\n  // Setup variables\r\n  let tableName = \"mockeries\";\r\n  let mockery = \"Now go away or I shall taunt you a second time-a!\"; // if table can't be found, use this.\r\n\r\n  if (!actor) {\r\n    ui.notifications.warn(\"You must have an actor selected.\");\r\n    return\r\n  }\r\n\r\n  let actorLevels = actor.data.data.levels || 1;\r\n  let table = game.tables.contents.find(t => t.name == tableName);\r\n  // Get Targets name\r\n  const targetId = game.user.targets.ids[0];\r\n  const targetToken = canvas.tokens.get(targetId);\r\n  if (!targetToken) {\r\n    ui.notifications.warn(\"You must target a token.\");\r\n    return\r\n  }\r\n  const targetName = targetToken.name;\r\n\r\n  // Roll the result, and mark it drawn\r\n  if (table) {\r\n    if (checkTable(table)) {\r\n      let roll = await table.roll();\r\n      let result = roll.results[0];\r\n      mockery = result.data.text;\r\n      await table.updateEmbeddedDocuments(\"TableResult\", [{\r\n        _id: result.id,\r\n        drawn: true\r\n      }]);\r\n    }\r\n  }\r\n\r\n  function checkTable(table) {\r\n    let results = 0;\r\n    for (let data of table.data.results) {\r\n      if (!data.drawn) {\r\n        results++;\r\n      }\r\n    }\r\n    if (results < 1) {\r\n      table.reset();\r\n      ui.notifications.notify(\"Table Reset\")\r\n      return false\r\n    }\r\n    return true\r\n  }\r\n\r\n  let dieType = 'd6';\r\n  if (actorLevels >= 15) {\r\n    dieType = 'd12';\r\n  } else if (actorLevels >= 10) {\r\n    dieType = 'd10';\r\n  } else if (actorLevels >= 5) {\r\n    dieType = 'd8';\r\n  }\r\n\r\n  let messageContent = `<p>${targetName} Reduce your roll by: <b>[[1${dieType}]]</b>.</p>`\r\n  messageContent += `<p>${token.name} exclaims <b><i>\"${mockery}\"</i></b></p>`\r\n  messageContent += `<details closed=\"\"><summary><a>Cutting Words</a></summary>\r\n  <p>When a creature that you can see within 60 feet of you makes an <b>Attack roll, an ability check, or a damage roll</b>, you can use your <b>Reaction</b> to expend one of your uses of <b>Bardic Inspiration</b>,\r\n  rolling a Bardic Inspiration die and subtracting the number rolled from the creature’s roll.</p>\r\n  <p>You can choose to use this feature after the creature makes its roll, but before the GM determines whether the Attack roll or ability check succeeds or fails, or before the creature deals its damage. \r\n  The creature is immune if it can’t hear you or if it’s immune to being <b>Charmed</b>.</p></details>`\r\n\r\n  // create the message\r\n  if (messageContent !== '') {\r\n    let chatData = {\r\n      user: game.user.id,\r\n      speaker: ChatMessage.getSpeaker(),\r\n      content: messageContent,\r\n    };\r\n    ChatMessage.create(chatData, {});\r\n  }\r\n};\r\n\r\ncuttingWords();\r\n",
  "author": "",
  "img": "icons/svg/dice-target.svg",
  "actorIds": [],
  "_id": "AbzZdXi97q8oHOUn"
}
